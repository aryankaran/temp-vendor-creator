name: Vendor generator

on:
  workflow_dispatch:
    inputs:
      download:
        description: 'Rom link'
        required: true
        default: 'https://download.havoc-os.com/onclite/Havoc-OS-v4.16-20220426-onclite-Official.zip'
jobs:
  Extract-and-upload-vendor:
    runs-on: ubuntu-20.04

    steps:
      - uses: actions/checkout@v3

      - name: Setup
        run: |
            sudo apt update; sudo apt install aria2 curl unzip lz4 -y; pwd
            cd /usr/bin && sudo bash -c "$(curl -sL https://git.io/file-transfer)" && cd -

      - name: Processing
        run: |
          echo Downloading file..
          # curl -O ${{ github.event.inputs.download }}
          aria2c -q -x10 -s20 ${{ github.event.inputs.download }}
          ls -lh
          unzip *zip -x s* -d rom
          cd rom;ls -lh;rm -rf install vbmeta.img recovery.img
          curl --create-dirs -L http://oshi.at/FggR -o META-INF/com/google/android/updater-script
          zip -x boot.img dtbo.img -r6 vendor.zip .;lz4 boot.img boot.img.lz4
          echo -e "\n\n\n\nUploading files to wetransfer"
          transfer --silent wet vendor.zip boot.img.lz4 dtbo.img
          curl -T boot.img.lz4 oshi.at
